<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LOVELYS è±ªè¯æ‹‰éœ¸æ©Ÿ</title>
  <style>
    :root {
      --primary: #ff6f91;
      --secondary: #ff9671;
      --accent: #d65db1;
      --bg: #fff0f5;
      
      /* === å°ºå¯¸è¨­å®š === */
      /* å–®æ ¼é«˜åº¦ (åœ–ç‰‡é«˜åº¦) */
      --item-height: 100px; 
      /* é¡¯ç¤ºå€åŸŸé«˜åº¦ = å–®æ ¼ x 3 (3x3 ä½ˆå±€) */
      --slot-view-height: calc(var(--item-height) * 3);
    }

    body {
      font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
      background-color: var(--bg);
      background-image: radial-gradient(var(--secondary) 1px, transparent 1px);
      background-size: 20px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 500px;
      text-align: center;
      position: relative;
    }

    /* è¼¸å…¥å€ */
    #start-screen {
      background: white;
      padding: 30px 20px;
      border-radius: 25px;
      box-shadow: 0 10px 30px rgba(214, 93, 177, 0.2);
      border: 3px solid white;
    }

    h1 { color: var(--accent); margin-top: 0; font-size: 1.8rem; text-transform: uppercase; }
    
    input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 15px;
      font-size: 1.4rem;
      border: 3px solid #eee;
      border-radius: 15px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--accent);
      outline: none;
      margin-bottom: 20px;
    }
    input:focus { border-color: var(--primary); }

    .btn-draw {
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 15px 0;
      width: 100%;
      font-size: 1.2rem;
      border-radius: 50px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(255, 111, 145, 0.4);
      transition: 0.2s;
    }
    .btn-draw:disabled { background: #ccc; cursor: wait; transform: none; box-shadow: none; }

    /* === æ‹‰éœ¸æ©Ÿå€åŸŸ (3x3) === */
    #slot-machine-area {
      display: none;
      background: var(--accent);
      padding: 15px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .machine-status {
      color: white;
      font-size: 1.2rem;
      margin-bottom: 15px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    .slot-container {
      display: flex;
      justify-content: space-between;
      gap: 5px;
      background: #222;
      padding: 5px;
      border-radius: 10px;
      border: 5px solid #ffccbc;
      height: var(--slot-view-height); /* 300px on desktop */
      overflow: hidden;
      position: relative;
    }

    /* 3x3 ä¸­é–“çš„ä¸­çç·š (ç´…ç·š) */
    .win-line {
      position: absolute;
      top: 50%; left: -10px; right: -10px;
      height: 4px;
      background: rgba(255, 0, 0, 0.6);
      z-index: 10;
      transform: translateY(-50%);
      box-shadow: 0 0 10px red;
      pointer-events: none;
    }
    /* ç»ç’ƒåå…‰è³ªæ„Ÿ */
    .slot-container::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 30%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.2), transparent);
      pointer-events: none;
      z-index: 5;
    }

    .reel {
      background: white;
      flex: 1;
      position: relative;
      overflow: hidden;
      border-radius: 4px;
    }

    .reel-strip {
      position: absolute;
      top: 0; left: 0; width: 100%;
      /* åˆå§‹ä½ç½®ç¨å¾®èª¿æ•´ï¼Œç¢ºä¿å°é½Š */
      will-change: transform;
    }

    .slot-item {
      height: var(--item-height); /* å›ºå®šé«˜åº¦ */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      border-bottom: 1px solid #eee;
      padding: 5px;
      overflow: hidden;
    }

    /* æ‹‰éœ¸æ©Ÿå…§çš„åœ–ç‰‡ */
    .slot-img {
      width: 100%;
      height: 80%; /* åœ–ç‰‡ä½”æ ¼å­çš„ 80% */
      object-fit: contain;
    }
    /* æ‹‰éœ¸æ©Ÿå…§çš„æ–‡å­— */
    .slot-text {
      font-size: 0.8rem;
      color: #333;
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }

    /* === çµæœå½ˆçª— === */
    #result-card {
      display: none;
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 25px;
      width: 85%; max-width: 400px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      z-index: 999;
      animation: popIn 0.5s cubic-bezier(0.17, 0.67, 0.43, 1.45);
      text-align: center;
    }
    #overlay {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 998;
      backdrop-filter: blur(3px);
    }
    
    .final-prize-img {
      width: 100%;
      max-height: 250px;
      object-fit: contain;
      border: 3px solid var(--primary);
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .status-msg { margin-top: 10px; color: var(--primary); font-weight: bold; font-size: 0.9rem; }
    .error { color: #e53935; }

    /* === æ‰‹æ©Ÿç‰ˆèª¿æ•´ === */
    @media screen and (max-width: 600px) {
      :root {
        /* æ‰‹æ©Ÿç‰ˆç¸®å°ä¸€é»ï¼Œé¿å…å¤ªé•· */
        --item-height: 80px; 
      }
      .slot-text { font-size: 0.7rem; }
    }

    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

  <div id="overlay"></div>

  <div class="container">
    
    <div id="start-screen">
      <h1>LOVELYS æŠ½ç</h1>
      <p style="color:#888; font-size:0.9rem;">è¼¸å…¥åºè™Ÿé–‹å§‹è½‰å‹•å¹¸é‹</p>
      
      <input type="text" id="code-input" placeholder="è«‹è¼¸å…¥åºè™Ÿ" maxlength="8" autocomplete="off">
      <button id="draw-btn" class="btn-draw">é–‹å§‹æŠ½ç</button>
      
      <div id="msg-box" class="status-msg"></div>
      <div id="loading-hint" style="display:none; color:#aaa; font-size:0.8rem; margin-top:5px;">æ­£åœ¨ä¸‹è¼‰åœ–ç‰‡ç´ æ...</div>
    </div>

    <div id="slot-machine-area">
      <div id="machine-status" class="machine-status">æº–å‚™å•Ÿå‹•...</div>
      
      <div class="slot-container">
        <div class="win-line"></div>
        
        <div class="reel"><div class="reel-strip" id="reel-1"></div></div>
        <div class="reel"><div class="reel-strip" id="reel-2"></div></div>
        <div class="reel"><div class="reel-strip" id="reel-3"></div></div>
      </div>
    </div>

    <div id="result-card">
      <h2 style="color:var(--secondary); margin:0 0 10px 0;">ğŸ‰ CONGRATULATIONS!</h2>
      <img id="final-img" class="final-prize-img" src="" alt="Prize">
      <h3 id="final-name" style="color:var(--accent); margin:5px 0;"></h3>
      <p id="final-detail" style="color:#666; margin:5px 0;"></p>
      <div style="background:#eee; padding:5px; border-radius:5px; display:inline-block; margin-top:10px;">
        <span style="font-size:0.8rem;">åºè™Ÿ: </span>
        <strong id="final-code" style="color:#555;"></strong>
      </div>
      <br>
      <button onclick="location.reload()" class="btn-draw" style="margin-top:20px; padding:10px 30px;">å†ç©ä¸€æ¬¡</button>
    </div>

  </div>

  <script>
    // â˜…â˜…â˜… è«‹æ›¿æ›æˆæ‚¨çš„ GAS ç¶²å€ â˜…â˜…â˜…
    const API_URL = 'https://script.google.com/macros/s/AKfycbyfF-yGRiOaEwTfb46Riji-ERnQqjhPL_uJ5rVeekGvI1j4-hmfPu3Jr4MkdeqhfcyHtw/exec';

    // å…¨åŸŸè®Šæ•¸ï¼šç”¨ä¾†å„²å­˜å¾å¾Œç«¯æŠ“ä¸‹ä¾†çš„åœ–ç‰‡å°ç…§è¡¨
    let CATALOG = {
      types: {},   // ç¨®é¡ -> ä»£è¡¨åœ–ç‰‡ URL
      colors: {}   // é¡è‰²(LOVELYS) -> ä»£è¡¨åœ–ç‰‡ URL
    };
    
    // é è¨­å¡«å……ç”¨ (è¬ä¸€åœ–ç‰‡æ²’è¼‰å…¥)
    const DEFAULT_TYPES = ['é›¨å‚˜å¨ƒ', 'ä¸‰éº—é·—', 'é¾è¦æ‰£', 'è»Ÿç³–', 'å·§å…‹åŠ›', 'é¤…ä¹¾', 'è»Šè»Š', 'æ¨¡å‹åŒ…'];
    const DEFAULT_LOVELYS = ['SAVELY', 'TZUVELY', 'MIVELY', 'JIVELY', 'CHAENGVELY', 'DAHYUN', 'NAYEON', 'JEONGYEON'];

    const drawBtn = document.getElementById('draw-btn');
    const codeInput = document.getElementById('code-input');
    const msgBox = document.getElementById('msg-box');
    const startScreen = document.getElementById('start-screen');
    const slotArea = document.getElementById('slot-machine-area');
    const machineStatus = document.getElementById('machine-status');
    const resultCard = document.getElementById('result-card');
    const overlay = document.getElementById('overlay');
    const loadingHint = document.getElementById('loading-hint');

    // === 1. åˆå§‹åŒ–ï¼šç¶²é è¼‰å…¥æ™‚å…ˆå»æŠ“ Catalog (ç‚ºäº†åœ–ç‰‡) ===
    window.onload = function() {
      fetchCatalog();
    };

    function fetchCatalog() {
      loadingHint.style.display = 'block';
      drawBtn.disabled = true; // å°šæœªè¼‰å…¥å®Œæˆå‰ä¸èƒ½æŒ‰

      fetch(API_URL + '?action=catalog')
        .then(res => res.json())
        .then(data => {
          if(data.ok) {
            processCatalog(data);
            loadingHint.style.display = 'none';
            drawBtn.disabled = false;
            console.log('åœ–ç‰‡ç´ æè¼‰å…¥å®Œæˆ', CATALOG);
          } else {
            console.warn('Catalog load failed', data);
            loadingHint.textContent = 'åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨ç´”æ–‡å­—æ¨¡å¼';
            drawBtn.disabled = false;
          }
        })
        .catch(err => {
          console.error(err);
          loadingHint.textContent = 'é€£ç·šç•°å¸¸';
          drawBtn.disabled = false;
        });
    }

    // è™•ç†å¾Œç«¯å›å‚³çš„è³‡æ–™ï¼Œå»ºç«‹ã€Œç¨®é¡ -> åœ–ç‰‡ã€èˆ‡ã€ŒLovelys -> åœ–ç‰‡ã€çš„ç´¢å¼•
    function processCatalog(data) {
      // 1. è™•ç† Types (ç¨®é¡)
      if (data.typeImages) {
        for (const [type, imgs] of Object.entries(data.typeImages)) {
          if (imgs && imgs.length > 0) {
            CATALOG.types[type] = imgs[0]; // æ¯å€‹ç¨®é¡åªå–ç¬¬ä¸€å¼µç•¶ä»£è¡¨åœ–
          }
        }
      }

      // 2. è™•ç† Colors (Lovelys)
      // è³‡æ–™çµæ§‹æ˜¯ typeLovelyImages[type][color] = [imgs...]
      // æˆ‘å€‘è¦æŠŠå®ƒæ”¤å¹³è®Šæˆ colors[color] = img
      if (data.typeLovelyImages) {
        for (const typeKey in data.typeLovelyImages) {
          const colorMap = data.typeLovelyImages[typeKey];
          for (const colorKey in colorMap) {
            const imgs = colorMap[colorKey];
            if (imgs && imgs.length > 0 && !CATALOG.colors[colorKey]) {
              CATALOG.colors[colorKey] = imgs[0]; // æ‰¾åˆ°é€™å€‹è…³è‰²çš„ç¬¬ä¸€å¼µåœ–å­˜èµ·ä¾†
            }
          }
        }
      }
    }

    // === 2. æŠ½çæµç¨‹ ===
    drawBtn.addEventListener('click', startProcess);
    codeInput.addEventListener('keypress', (e) => { if(e.key==='Enter') startProcess(); });

    function startProcess() {
      const code = codeInput.value.trim().toUpperCase();
      if(!code) return showMsg('è«‹è¼¸å…¥åºè™Ÿ', 'error');

      codeInput.blur(); // æ”¶èµ·æ‰‹æ©Ÿéµç›¤
      drawBtn.disabled = true;
      drawBtn.textContent = 'é©—è­‰åºè™Ÿä¸­...';
      showMsg('', 'normal');

      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ action: 'draw', code: code })
      })
      .then(res => res.json())
      .then(data => {
        if(data.ok) {
          startScreen.style.display = 'none';
          slotArea.style.display = 'block';
          // è‡ªå‹•æ²å‹•åˆ°æ‹‰éœ¸æ©Ÿ (æ‰‹æ©Ÿå„ªåŒ–)
          setTimeout(() => slotArea.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
          
          runSlotAnimation(data);
        } else {
          showMsg(data.message, 'error');
          drawBtn.disabled = false;
          drawBtn.textContent = 'é–‹å§‹æŠ½ç';
        }
      })
      .catch(err => {
        showMsg('ç¶²è·¯éŒ¯èª¤', 'error');
        drawBtn.disabled = false;
        drawBtn.textContent = 'é–‹å§‹æŠ½ç';
      });
    }

    // === 3. å‹•ç•«ä¸»æ§å° ===
    async function runSlotAnimation(data) {
      // æº–å‚™éšæ®µ 1 çš„éš¨æ©Ÿæ±  (Type)
      // å¦‚æœ Catalog æœ‰è³‡æ–™å°±ç”¨ Catalog çš„ keyï¼Œæ²’æœ‰å°±ç”¨é è¨­æ–‡å­—
      const typeKeys = Object.keys(CATALOG.types).length > 0 ? Object.keys(CATALOG.types) : DEFAULT_TYPES;
      
      // éšæ®µ 1: æŠ½ç¨®é¡ (Type)
      machineStatus.textContent = 'âœ¨ æŠ½é¸ç¨®é¡ä¸­... âœ¨';
      // æ³¨æ„ï¼šé€™è£¡ targetImg å‚³å…¥ null ä»£è¡¨è®“ spinLogic è‡ªå·±å» CATALOG æ‰¾ data.type çš„åœ–
      await spinAllReels(typeKeys, data.type, 'TYPE');

      await wait(1000); // åœé “ 1 ç§’

      // æº–å‚™éšæ®µ 2 çš„éš¨æ©Ÿæ±  (Color/Lovelys)
      const colorKeys = Object.keys(CATALOG.colors).length > 0 ? Object.keys(CATALOG.colors) : DEFAULT_LOVELYS;

      // éšæ®µ 2: æŠ½ Lovelys (Color)
      machineStatus.textContent = 'ğŸ’– å¬å–š LOVELYS... ğŸ’–';
      machineStatus.style.color = '#ffeb3b';
      await spinAllReels(colorKeys, data.color, 'COLOR');

      await wait(800);
      showFinalResult(data);
    }

    // å•Ÿå‹•ä¸‰è»¸è½‰å‹• (æ§åˆ¶è½‰é€Ÿèˆ‡åœä¸‹é †åº)
    function spinAllReels(poolKeys, targetText, mode) {
      return new Promise(resolve => {
        const reels = [
          document.getElementById('reel-1'),
          document.getElementById('reel-2'),
          document.getElementById('reel-3')
        ];

        // é€™è£¡è¨­å®šæ™‚é–“ï¼šç¬¬ä¸€æ¢ 3ç§’ï¼Œç¬¬äºŒæ¢ 4ç§’ï¼Œç¬¬ä¸‰æ¢ 5ç§’ (æ…¢æ…¢åœ)
        const durations = [3000, 4500, 6000];

        // å–å¾—å–®æ ¼é«˜åº¦ (CSSè®Šæ•¸) -> è½‰æˆæ•¸å­—
        const style = getComputedStyle(document.documentElement);
        const itemHeight = parseInt(style.getPropertyValue('--item-height')) || 100;

        // åˆ†åˆ¥å•Ÿå‹•
        spinOneReel(reels[0], poolKeys, targetText, mode, durations[0], itemHeight);
        spinOneReel(reels[1], poolKeys, targetText, mode, durations[1], itemHeight);
        
        // ç¬¬ä¸‰æ¢è½‰å®Œæ‰ç®— Promise çµæŸ
        spinOneReel(reels[2], poolKeys, targetText, mode, durations[2], itemHeight, resolve);
      });
    }

    /**
     * å–®è»¸è½‰å‹•é‚è¼¯
     * @param {HTMLElement} element - æ²è»¸ DOM
     * @param {Array} pool - éš¨æ©Ÿæ±  (Keys)
     * @param {String} target - ç›®æ¨™ Key
     * @param {String} mode - 'TYPE' æˆ– 'COLOR' (ç”¨ä¾†æ±ºå®šå»å“ªæ‰¾åœ–)
     * @param {Number} duration - å‹•ç•«æ™‚é–“(ms)
     * @param {Number} itemHeight - å–®æ ¼é«˜åº¦(px)
     * @param {Function} callback - çµæŸå›å‘¼
     */
    function spinOneReel(element, pool, target, mode, duration, itemHeight, callback) {
      let html = '';
      // ç”¢ç”Ÿéš¨æ©Ÿé …ç›® (æ•¸é‡è¦å¤ å¤šæ‰æœ‰è½‰å‹•æ„Ÿï¼Œä¾‹å¦‚ 40 å€‹)
      const count = 40; 
      
      for(let i=0; i<count; i++) {
        const randomKey = pool[Math.floor(Math.random() * pool.length)];
        const imgUrl = getImgUrl(mode, randomKey);
        html += createSlotItemHtml(randomKey, imgUrl);
      }

      // === é—œéµä¿®æ­£ï¼š3x3 é¡¯ç¤ºé‚è¼¯ ===
      // ç•¶æˆ‘å€‘åœä¸‹ä¾†æ™‚ï¼Œç›®æ¨™å¿…é ˆåœ¨ã€Œä¸­é–“é‚£ä¸€æ ¼ã€ã€‚
      // çµæ§‹æ‡‰è©²æ˜¯ï¼š [éš¨æ©Ÿ...] + [ä¸Šä¸€å€‹] + [ç›®æ¨™(ä¸­)] + [ä¸‹ä¸€å€‹]
      // é€™æ¨£åœåœ¨ [ç›®æ¨™] çš„ä½ç½®æ™‚ï¼Œä¸Šä¸‹æ‰æœƒæœ‰æ±è¥¿ï¼Œä¸æœƒç©ºç™½ã€‚
      
      const targetImg = getImgUrl(mode, target);
      
      // æ·»åŠ ç›®æ¨™å‰çš„è£é£¾ (ä½æ–¼ä¸Šæ–¹)
      const prevKey = pool[Math.floor(Math.random() * pool.length)];
      html += createSlotItemHtml(prevKey, getImgUrl(mode, prevKey));

      // â˜… ç›®æ¨™ (é€™æ ¼æœƒåœåœ¨æ­£ä¸­é–“) â˜…
      html += createSlotItemHtml(target, targetImg);

      // æ·»åŠ ç›®æ¨™å¾Œçš„è£é£¾ (ä½æ–¼ä¸‹æ–¹)
      const nextKey = pool[Math.floor(Math.random() * pool.length)];
      html += createSlotItemHtml(nextKey, getImgUrl(mode, nextKey));

      // å¡«å…¥ HTML
      element.innerHTML = html;
      
      // é‡ç½®ä½ç½®
      element.style.transition = 'none';
      element.style.transform = 'translateY(0)';
      element.offsetHeight; // å¼·åˆ¶é‡ç¹ª

      // è¨ˆç®—ä½ç§»
      // æˆ‘å€‘è¦è®“ [ç›®æ¨™] åœåœ¨è¦–çª—çš„ä¸­é–“ã€‚
      // è¦–çª—é«˜åº¦ = 3 * itemHeightã€‚ ä¸­é–“ä½ç½®æ˜¯ top: itemHeightã€‚
      // ç¾åœ¨ç¸½å…±æœ‰ count + 3 å€‹é …ç›®ã€‚
      // ç›®æ¨™æ˜¯å€’æ•¸ç¬¬ 2 å€‹ (ç´¢å¼• count + 1)ã€‚
      // ç›®æ¨™çš„ top ä½ç½®æ˜¯ (count + 1) * itemHeightã€‚
      // æˆ‘å€‘è¦ç§»å‹•è®“ç›®æ¨™çš„ top è®Šæˆ itemHeight (ç›¸å°æ–¼è¦–çª—)ã€‚
      // æ‰€ä»¥ translateY = - (ç›®æ¨™åŸå§‹top - è¦–çª—ç›®æ¨™top)
      // translateY = - ( (count+1)*h - 1*h ) = - (count * h)
      
      const finalY = -1 * (count * itemHeight);

      // å•Ÿå‹• CSS å‹•ç•« (cubic-bezier è®“çµå°¾æœ‰ç…è»Šæ„Ÿ)
      element.style.transition = `transform ${duration}ms cubic-bezier(0.15, 0.9, 0.30, 1)`;
      element.style.transform = `translateY(${finalY}px)`;

      if(callback) {
        setTimeout(callback, duration);
      }
    }

    // è¼”åŠ©ï¼šç”¢ç”Ÿå–®æ ¼ HTML
    function createSlotItemHtml(text, imgUrl) {
      let content = '';
      if (imgUrl) {
        content = `<img src="${imgUrl}" class="slot-img" alt="${text}"><div class="slot-text">${text}</div>`;
      } else {
        // æ²’æœ‰åœ–å°±é¡¯ç¤ºæ–‡å­—å¤§ä¸€é»
        content = `<div style="font-size:1.5rem; color:#d65db1;">${text}</div>`;
      }
      return `<div class="slot-item">${content}</div>`;
    }

    // è¼”åŠ©ï¼šæ ¹æ“šæ¨¡å¼èˆ‡Keyæ‰¾åœ–ç‰‡
    function getImgUrl(mode, key) {
      if (mode === 'TYPE') {
        return CATALOG.types[key] || '';
      } else if (mode === 'COLOR') {
        return CATALOG.colors[key] || '';
      }
      return '';
    }

    function showFinalResult(data) {
      document.getElementById('final-name').textContent = data.display_name;
      document.getElementById('final-detail').textContent = `${data.type} / ${data.color}`;
      document.getElementById('final-code').textContent = data.prize_key;

      const img = document.getElementById('final-img');
      if(data.image_url) {
        img.src = data.image_url;
        img.style.display = 'block';
      } else {
        img.style.display = 'none';
      }

      overlay.style.display = 'block';
      resultCard.style.display = 'block';
    }

    function showMsg(text, type) {
      msgBox.textContent = text;
      msgBox.className = 'status-msg ' + (type === 'error' ? 'error' : '');
    }

    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
  </script>
</body>
</html>
